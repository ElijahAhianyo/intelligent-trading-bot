# Service Server

[_Documentation generated by Documatic_](https://www.documatic.com)

<!---Documatic-section-Codebase Structure-start--->
## Codebase Structure

<!---Documatic-block-system_architecture-start--->
```mermaid
None
```
<!---Documatic-block-system_architecture-end--->

# #
<!---Documatic-section-Codebase Structure-end--->

<!---Documatic-section-service.server.main_task-start--->
## [service.server.main_task](4-service_server.md#service.server.main_task)

<!---Documatic-section-main_task-start--->
<!---Documatic-block-service.server.main_task-start--->
<details>
	<summary><code>service.server.main_task</code> code snippet</summary>

```python
async def main_task():
    res = await main_collector_task()
    if res:
        return res
    try:
        analyze_task = await App.loop.run_in_executor(None, App.analyzer.analyze)
    except Exception as e:
        print(f'Error while analyzing data: {e}')
        return
    if 'notify' in App.config['actions']:
        notify_task = App.loop.create_task(notify_telegram())
    if 'trade' in App.config['actions']:
        trade_task = App.loop.create_task(main_trader_task())
    return
```
</details>
<!---Documatic-block-service.server.main_task-end--->
<!---Documatic-section-main_task-end--->

# #
<!---Documatic-section-service.server.main_task-end--->

<!---Documatic-section-service.server.start_server-start--->
## [service.server.start_server](4-service_server.md#service.server.start_server)

<!---Documatic-section-start_server-start--->
<!---Documatic-block-service.server.start_server-start--->
<details>
	<summary><code>service.server.start_server</code> code snippet</summary>

```python
@click.command()
@click.option('--config_file', '-c', type=click.Path(), default='', help='Configuration file name')
def start_server(config_file):
    load_config(config_file)
    symbol = App.config['symbol']
    print(f'Initializing server. Trade pair: {symbol}. ')
    App.client = Client(api_key=App.config['api_key'], api_secret=App.config['api_secret'])
    App.analyzer = Analyzer(App.config)
    App.loop = asyncio.get_event_loop()
    try:
        App.loop.run_until_complete(data_provider_health_check())
    except Exception as e:
        print(f'Problems during health check (connectivity, server etc.) {e}')
    if data_provider_problems_exist():
        print(f'Problems during health check (connectivity, server etc.)')
        return
    print(f'Finished health check (connection, server status etc.)')
    try:
        App.loop.run_until_complete(sync_data_collector_task())
        App.loop.run_until_complete(sync_data_collector_task())
    except Exception as e:
        print(f'Problems during initial data collection. {e}')
    if data_provider_problems_exist():
        print(f'Problems during initial data collection.')
        return
    print(f'Finished initial data collection.')
    if 'trade' in App.config['actions']:
        try:
            App.loop.run_until_complete(update_trade_status())
        except Exception as e:
            print(f'Problems trade status sync. {e}')
        if data_provider_problems_exist():
            print(f'Problems trade status sync.')
            return
        print(f'Finished trade status sync (account, balances etc.)')
        print(f"Balance: {App.config['base_asset']} = {str(App.base_quantity)}")
        print(f"Balance: {App.config['quote_asset']} = {str(App.quote_quantity)}")
    App.sched = AsyncIOScheduler()
    logging.getLogger('apscheduler').setLevel(logging.WARNING)
    App.sched.add_job(main_task, trigger='cron', minute='*', id='main_task')
    App.sched.start()
    print(f'Scheduler started.')
    try:
        App.loop.run_forever()
    except KeyboardInterrupt:
        print(f'KeyboardInterrupt.')
    finally:
        App.loop.close()
        print(f'Event loop closed.')
        App.sched.shutdown()
        print(f'Scheduler shutdown.')
    return 0
```
</details>
<!---Documatic-block-service.server.start_server-end--->
<!---Documatic-section-start_server-end--->

# #
<!---Documatic-section-service.server.start_server-end--->

[_Documentation generated by Documatic_](https://www.documatic.com)